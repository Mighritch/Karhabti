{% extends "layout.twig" %}

{% block content %}
<div class="auth-container">
  <div class="auth-card">
    <h1>S'inscrire</h1>
    
    <form id="signupForm" method="POST" action="/api/users/signup">
      <div class="form-group">
        <label for="nom">Nom:</label>
        <input type="text" id="nom" name="nom" required>
      </div>

      <div class="form-group">
        <label for="prenom">Prénom:</label>
        <input type="text" id="prenom" name="prenom" required>
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
      </div>

      <div class="form-group">
        <label for="telephone">Téléphone:</label>
        <input type="tel" id="telephone" name="telephone" required>
      </div>

      <div class="form-group">
        <label for="dateNaissance">Date de naissance:</label>
        <input type="date" id="dateNaissance" name="dateNaissance" required>
      </div>

      <div class="form-group">
        <label for="mdp">Mot de passe:</label>
        <input type="password" id="mdp" name="mdp" required>
      </div>

      <div class="form-group">
        <label for="confirmMdp">Confirmer le mot de passe:</label>
        <input type="password" id="confirmMdp" name="confirmMdp" required>
      </div>

      <button type="submit" class="btn btn-primary">S'inscrire</button>
    </form>

    <p class="auth-footer">
      Déjà un compte? <a href="/signin">Se connecter</a>
    </p>

    <div id="message"></div>
  </div>
</div>

<style>
  .auth-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
  }

  .auth-card {
    background: white;
    padding: 40px;
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    width: 100%;
    max-width: 500px;
  }

  .auth-card h1 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 5px;
    color: #333;
    font-weight: 500;
  }

  .form-group input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1em;
    box-sizing: border-box;
  }

  .form-group input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .btn {
    width: 100%;
    padding: 12px;
    background: #667eea;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .btn:hover {
    background: #5568d3;
  }

  .auth-footer {
    text-align: center;
    margin-top: 20px;
    color: #666;
  }

  .auth-footer a {
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
  }

  .auth-footer a:hover {
    text-decoration: underline;
  }

  #message {
    margin-top: 20px;
    padding: 10px;
    text-align: center;
    min-height: 20px;
  }
</style>

<script>
  document.getElementById('signupForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const nom = document.getElementById('nom').value;
    const prenom = document.getElementById('prenom').value;
    const email = document.getElementById('email').value;
    const telephone = document.getElementById('telephone').value;
    const dateNaissance = document.getElementById('dateNaissance').value;
    const mdp = document.getElementById('mdp').value;
    const confirmMdp = document.getElementById('confirmMdp').value;
    const messageDiv = document.getElementById('message');

    if (mdp !== confirmMdp) {
      messageDiv.innerHTML = '<div style="color: red; background: #fee; padding: 10px; border-radius: 4px;">Les mots de passe ne correspondent pas</div>';
      return;
    }

    try {
      const response = await fetch('/api/users/signup', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ nom, prenom, email, telephone, dateNaissance, mdp, confirmMdp })
      });

      const data = await response.json();

      if (data.success) {
        // Stocker le token dans localStorage
        localStorage.setItem('token', data.token);
        localStorage.setItem('user', JSON.stringify(data.user));
        
        // Rediriger vers le dashboard
        window.location.href = '/dashboard';
      } else {
        messageDiv.innerHTML = '<div style="color: red; background: #fee; padding: 10px; border-radius: 4px;">' + data.message + '</div>';
      }
    } catch (error) {
      messageDiv.innerHTML = '<div style="color: red; background: #fee; padding: 10px; border-radius: 4px;">Erreur lors de l\'inscription</div>';
    }
  });
</script>
{% endblock %}
